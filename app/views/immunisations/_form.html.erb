<%= form_with(model: immunisation, local: true, class: "card") do |f| %>
  <div class="card-body">

    <% if immunisation.errors.any? %>
      <div class="alert alert-danger">
        <p class="fw-semibold mb-2">
          <%= pluralize(immunisation.errors.count, "error") %> prevented saving:
        </p>
        <ul class="mb-0 ps-3">
          <% immunisation.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="row g-3">
      <div class="col-12 col-md-6">
        <%= f.label :patient_id, "Patient", class: "form-label" %>
        <%= f.collection_select :patient_id,
              Patient.order(:last_name, :first_name),
              :id, ->(p) { "#{p.last_name}, #{p.first_name}" },
              { prompt: "Select patient" },
              { class: "form-select" } %>
      </div>

      <div class="col-12 col-md-6">
        <%= f.label :vaccine_id, "Vaccine", class: "form-label" %>
        <%= f.collection_select :vaccine_id,
              Vaccine.order(:name),
              :id, :name,
              { prompt: "Select vaccine" },
              { class: "form-select" } %>
      </div>

      <div class="col-12 col-md-6">
        <%= f.label :administered_on, class: "form-label" %>
        <%= f.date_field :administered_on, class: "form-control" %>
      </div>

      <div class="col-12 col-md-6">
        <%= f.label :administered_by, class: "form-label" %>
        <%= f.text_field :administered_by, class: "form-control" %>
      </div>

      <div class="col-12 col-md-6">
        <%= f.label :batch_number, class: "form-label" %>
        <%= f.text_field :batch_number, class: "form-control" %>
      </div>

      <div class="col-12 col-md-6">
        <%= f.label :next_due_date, class: "form-label" %>
        <%= f.date_field :next_due_date, class: "form-control" %>
      </div>
    </div>

  </div>

  <div class="card-footer d-flex justify-content-end gap-2">
<%= link_to "Cancel",
            (immunisation.persisted? ? immunisation_path(immunisation) : immunisations_path),
            class: "btn btn-outline-secondary" %>
    <%= f.submit(immunisation.persisted? ? "Update Immunisation" : "Create Immunisation",
                 class: "btn btn-primary") %>
  </div>
<% end %>
